<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle de Producto</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    {% include '_sidebar.html' %}
    <div class="container" style="margin-top:2rem;">
        <a href="/" class="btn btn-secondary">← Volver al catálogo</a>
        <div class="detalle-producto-card">
            <h2>{{ producto.nombre }}</h2>
            {% if producto.imagen_url %}
                <img src="{{ producto.imagen_url }}" alt="Imagen de {{ producto.nombre }}" style="max-width:220px; max-height:220px; border-radius:8px; margin-bottom:1rem;">
            {% endif %}
            <p><strong>Descripción:</strong> {{ producto.descripcion or 'Sin descripción' }}</p>
            <p><strong>Categoría:</strong> {{ producto.categoria or 'Sin categoría' }}</p>
            <p><strong>Precio:</strong> ${{ '%.2f'|format(producto.precio) }}</p>
            <p><strong>Stock:</strong> {{ producto.cantidad }}</p>
            <p><strong>Fecha de creación:</strong> {{ producto.fecha_creacion or 'N/A' }}</p>
        </div>

        <div class="detalle-proveedores" style="margin-top:2rem;">
            <h3>Proveedores y Precios</h3>
            {% if proveedores and proveedores|length > 0 %}
                <table class="tabla-proveedores" style="width:100%; border-collapse:collapse;">
                    <thead>
                        <tr style="background:#e3f2fd;">
                            <th>Proveedor</th>
                            <th>Precio</th>
                            <th>Fecha precio</th>
                            <th>Cantidad mínima</th>
                            <th>Historial de Precios</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in proveedores %}
                        <tr>
                            <td>{{ p.proveedor.nombre if p.proveedor else 'Sin proveedor' }}</td>
                            <td>${{ '%.2f'|format(p.precio_proveedor) }}</td>
                            <td>{{ p.fecha_precio or 'N/A' }}</td>
                            <td>{{ p.cantidad_minima }}</td>
                            <td>
                                {% if p.historial_precios and p.historial_precios|length > 0 %}
                                    <ul style="margin:0; padding-left:1em;">
                                    {% for h in p.historial_precios %}
                                        <li>${{ '%.2f'|format(h.precio) }} ({{ h.fecha_precio }})</li>
                                    {% endfor %}
                                    </ul>
                                {% else %}
                                    <span style="color:#888;">Sin historial</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p style="color:#888;">Este producto no tiene proveedores asignados.</p>
            {% endif %}
        </div>
    </div>
</body>
</html>
