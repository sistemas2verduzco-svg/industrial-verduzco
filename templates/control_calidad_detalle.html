<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Calidad — {{ maquina.nombre }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    {% include '_sidebar.html' %}

    <div class="container">
        <h2>Control de Calidad — {{ maquina.nombre }}</h2>

        <div style="display:flex; gap:24px; margin-top:12px; align-items:flex-start;">
            <div style="width:420px; border:1px solid #e6e6e6; padding:12px; border-radius:8px; background:#fff;">
                {% if maquina.imagen_url %}
                    <img src="{{ maquina.imagen_url }}" alt="{{ maquina.nombre }}" style="width:100%; height:auto; object-fit:contain;" />
                {% else %}
                    <div style="height:240px; display:flex; align-items:center; justify-content:center; color:#aaa;">Sin imagen de la máquina</div>
                {% endif %}
                <div style="margin-top:8px; color:#666;">{{ maquina.descripcion }}</div>
            </div>

            <div style="flex:1;">
                <form method="post" enctype="multipart/form-data">
                    <div style="background:#fff; padding:12px; border-radius:8px; border:1px solid #e6e6e6;">
                        <h4>Checklist de componentes</h4>
                        <p style="color:#666; font-size:13px;">Marca la casilla si el componente funciona correctamente. Puedes subir evidencias (foto por componente).</p>

                        {% for idx, comp in enumerate(componentes) %}
                        <div style="display:flex; gap:12px; align-items:center; margin:10px 0; border-bottom:1px dashed #f0f0f0; padding-bottom:8px;">
                            <div style="width:90px; height:70px; background:#fafafa; display:flex; align-items:center; justify-content:center; border-radius:6px; overflow:hidden;">
                                {% if comp.image_url %}
                                    <img src="{{ comp.image_url }}" style="max-width:100%; max-height:100%; object-fit:cover;" />
                                {% else %}
                                    <div style="color:#aaa; font-size:12px; text-align:center;">Imagen<br>no disponible</div>
                                {% endif %}
                            </div>
                            <div style="flex:1;">
                                <div style="font-weight:600;">{{ comp.nombre }}</div>
                            </div>
                            <div style="display:flex; flex-direction:column; align-items:center; gap:6px;">
                                <label style="display:flex; gap:6px; align-items:center;">
                                    <input type="checkbox" name="check_{{ idx }}" value="1" {% if comp.checked %}checked{% endif %} />
                                    <span>OK</span>
                                </label>
                                <input type="file" name="evidence_{{ idx }}" accept="image/*" />
                            </div>
                        </div>
                        {% endfor %}

                        <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
                            <label style="font-size:13px; color:#666;">Observaciones:</label>
                            <input type="text" name="observaciones" style="flex:1; padding:8px; border-radius:6px; border:1px solid #ddd;" />
                        </div>

                        <div style="margin-top:12px; display:flex; gap:8px;">
                            <button type="submit" class="btn btn-primary" style="padding:8px 12px; background:#0b74de; color:#fff; border-radius:6px; border:none;">Guardar informe</button>
                            <a href="/control_calidad" class="btn" style="padding:8px 12px; border-radius:6px; border:1px solid #ddd; text-decoration:none;">Volver</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        {% if informe_guardado %}
        <div style="margin-top:12px; padding:10px; background:#e8f5e9; border:1px solid #c8e6c9; border-radius:6px; color:#256029;">Informe guardado.</div>
        {% endif %}
    </div>
</body>
</html>
<!-- Template removed: control_calidad_detalle (reverted) -->
